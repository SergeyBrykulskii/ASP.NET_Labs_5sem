@page "/pictures"
@page "/pictures/{genre}"
@attribute [Authorize]
@using Domain.Entities;
@using Microsoft.AspNetCore.Authorization;
@using Web_153501_Brykulskii.BlazorWasm.Components

<PageTitle>Pictures</PageTitle>
<GenreSelector/>
<PicturesList PictureSelected="FindPicture"/>
<Pager Genre="@Genre" TotalPages="@DataService.TotalPages" CurrentPage="@DataService.CurrentPage" />
<PictureDetails SelectedPicture="@SelectedPicture"/>

@code {
    [Inject]
    public IDataService DataService { get; set; }

    [Parameter]
    public string Genre { get; set; }
    public string? SelectedGenre { get; set; }
    public Picture? SelectedPicture { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await DataService.GetPicturesListAsync(null);
    }

    protected override async Task OnParametersSetAsync()
    {
        await DataService.GetPicturesListAsync(Genre);

        if (Genre != null)
        {
            SelectedGenre = DataService?.Genres?.FirstOrDefault(c => c.NormalizedName.Equals(Genre))?.Name;
        }
        else
        {
            SelectedGenre = "Все";
        }

    }

    public void FindPicture(int id)
    {
        SelectedPicture = DataService?.Pictures?.FirstOrDefault(c => c.Id == id);
        StateHasChanged();
    }
}
